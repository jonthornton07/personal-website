---
import type { WorkModel } from "../data/resume";
import WorkImage from "./WorkImage.astro";

const work: WorkModel = Astro.props as WorkModel;
const primaryTitle = work.titles[0]?.title || 'Position';
---
<div class="flex-grow work-experience" data-company={work.companyName} data-position={primaryTitle}>
  <div class="p-2 mt-2">
    <div class="flex">
      <div class="flex flex-row items-center px-3">
        <WorkImage
          imagePath={work.logo}
          altText={work.logoAlt}
        />
      </div>
      <div class="flex flex-col">
        <div class="text-lg leading-7 text-gray-900 font-sans antialiased font-semibold">
          {work.companyName}
        </div>
        <div class="text-sm leading-7 text-slate-500 font-sans antialiased -mt-1">
          {
            work.titles.map((title) => (
              <div>
                <span> {title.title} | {title.timeframe } </span>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>

  <div class="mx-5 pl-5 border-t pt-3 text-gray-900">
    {work.highlights.map((value) => (
      <li>{value}</li>
    ))}
  </div>
</div>

<script>
  import { trackWorkExperienceView } from '../utils/posthog-tracking';

  document.addEventListener('DOMContentLoaded', () => {
    const workExperiences = document.querySelectorAll('.work-experience');

    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.5
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const target = entry.target as HTMLElement;
          const company = target.dataset.company || 'unknown';
          const position = target.dataset.position || 'unknown';
          trackWorkExperienceView(company, position);
          observer.unobserve(target);
        }
      });
    }, observerOptions);

    workExperiences.forEach(exp => observer.observe(exp));
  });
</script>